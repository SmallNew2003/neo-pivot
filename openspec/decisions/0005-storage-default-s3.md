# 0005：MVP 默认文件存储选择 S3（S3 兼容优先）

## 状态

已决定

## 背景

文档存储是 RAG 的基础设施能力。为满足高扩展性与企业化演进，MVP 需要默认落地到对象存储，同时仍允许本地开发有简化路径。

## 决策

- MVP 默认文件存储使用 `S3`（或 S3 兼容实现），`documents.storage_uri` 使用 `s3://bucket/key`。
- 本地开发/CI 优先采用 MinIO（S3 兼容端点），以保持接口与 URI 形态一致，避免出现“本地一套、线上一套”的分叉。

## 具体约定

- URI：
  - `s3://bucket/key`：统一表示对象存储中的文件对象
- 配置项（实现阶段落地）至少包含：
  - endpoint（用于区分 AWS S3 与 MinIO）
  - bucket
  - accessKey / secretKey（或 IAM Role/STS）
  - region（如使用 AWS S3）

## 影响与权衡

优点：

- 默认路径企业化，便于对外说明“对象存储与可扩展架构”。
- 通过 MinIO 保证本地可复现，且与 AWS S3 形态一致。

代价：

- 本地启动需要额外依赖（MinIO）或需配置 AWS 账号（不建议作为默认）。

## 后续工作

- 明确 bucket 命名与 key 组织规则（例如按 userId/documentId 分层）。
- 明确上传/下载的超时、分片上传策略（MVP 可先不做分片，后续再提案）。
- 明确删除与生命周期策略（对象清理、版本管理、归档等）。
