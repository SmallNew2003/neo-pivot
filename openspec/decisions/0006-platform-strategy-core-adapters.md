# 0006：平台策略选择“核心底座 + 适配层 + 多平台可选”

## 状态

已决定

## 背景

项目希望同时满足：

- 技术深度：Java 原生底座体现模块化单体、最终一致性、权限与存储等工程能力。
- 场景覆盖：可根据业务选择 Coze（交付）、Dify（AI 应用生命周期）、n8n（流程集成）。
- 可控交付：MVP 不应因“全平台同时深度集成”而失控。

## 决策

采用“核心底座 + 适配层 + 多平台可选”的总体策略（对应提案 `openspec/proposals/0002-platform-integration-strategy.md`）：

- 核心底座负责数据与规则的权威性（认证/鉴权、文档、对象存储、向量检索与权限过滤、索引状态机）。
- 各平台通过适配层接入，平台差异不渗透到核心业务模型。
- MVP 主路径默认落地一个平台入口（当前默认：Coze），其余平台优先完成“设计与可复现接入说明”，再分阶段实现。
- 主路径生成策略：最终答案生成由核心底座统一负责（模式A，见 `openspec/decisions/0008-generation-owned-by-core.md`）。

## 约束（必须遵守）

- 平台相关的鉴权、字段、回调格式不得进入核心领域模型（避免平台锁定）。
- 核心底座对外 API 的语义应稳定；平台只是不同客户端/编排器。
- 不允许在 MVP 阶段同时存在“两套权威的索引与检索真相来源”（避免 Dify 与底座各做一套 RAG）。

## 影响与权衡

优点：

- 对外表达更清晰：可讲清“选型权衡与可扩展架构”。
- 降低供应商锁定与平台替换成本。
- MVP 交付可控：默认主路径 + 其余平台渐进落地。

代价：

- 需要额外维护适配层与文档，增加一定的抽象与配置复杂度。

## 后续工作

- 在 `openspec/specs/0001-mvp-rag-knowledge-nexus-spec.md` 中补充平台适配的接口/事件约定（不引入实现细节）。
- 为 Dify/n8n 输出最小可复现的接入说明（先文档，后实现）。
