# 0012：中间件与基础设施基线清单（分阶段）

## 状态

已决定

## 背景

需要在不牺牲“可演进性”的前提下，尽量减少早期依赖，确保本地可复现与交付节奏。

## 决策

采用“分阶段基线”：

- P1（MVP 必选）：只上跑通闭环所需的最小中间件
- P2（增强）：在不改变核心语义前提下增强稳定性与可观测性
- P3（规模化/企业化）：按真实生产需求引入

## P1：MVP 必选

- 数据库：PostgreSQL + PGVector（向量检索与关系数据同源）
- 对象存储：S3（本地用 MinIO）
- LLM/Embedding：默认 OpenAI（可扩展到更多 Provider/兼容接口）

## P2：增强（按需）

- 缓存/限流：Redis（登录限流、幂等辅助、热点缓存）
- 可观测性：OpenTelemetry（trace）+ Prometheus（metrics）+ Loki/ELK（logs）择一组合
- 任务调度：Quartz（仅当确有定时任务需求）

## P3：规模化/企业化（后置）

- 消息队列：Kafka / RabbitMQ（用于跨进程事件、削峰、可靠投递）
- API 网关：Kong / APISIX / Spring Cloud Gateway（统一鉴权、限流、审计）
- 配置与密钥管理：Vault / KMS / SSM 等

## 约束

- 引入任何新中间件必须有明确的“解决的问题”和“替代方案为什么不够”。
- 避免在 MVP 阶段为“可能用得上”而提前引入复杂基础设施。

