# 0003：文档存储多实现可插拔（本地 + S3/MinIO）

## 状态

已决定

## 背景

RAG 系统必然涉及文档文件存储。MVP 需要：

- 本地可快速启动（不强依赖外部对象存储）。
- 具备企业化演进路径（支持 S3/MinIO）。
- 上层索引流程只关心“可读取的文件内容”，不关心存储介质。

## 决策

采用“存储可插拔（Pluggable Storage）”设计：

- 通过统一的 `storage_uri` 定位文档对象。
- 提供至少两类存储实现的扩展位：
  - 本地文件系统（`file://`）
  - S3 兼容（含 AWS S3、MinIO，使用 `s3://`）

## 具体约定

- `documents.storage_uri` 使用带 scheme 的 URI：
  - 本地示例：`file:///abs/path/to/file`
  - S3/MinIO 示例：`s3://bucket/key`
- `s3://` 的 endpoint、accessKey、secretKey、region 等通过配置注入；MinIO 仅是 S3 兼容端点的一个实现。

## 影响与权衡

优点：

- MVP 可先用本地存储快速闭环，后续无缝切换到对象存储。
- 业务代码不会被“路径/SDK”污染，利于演进与测试。

代价：

- 需要抽象出存储访问接口与错误处理策略（在实现阶段补齐）。

## 后续工作

- 确定 MVP 默认存储实现（已确认：默认 S3 / S3 兼容；本地/CI 采用 MinIO）。
- 明确清理策略（删除文档时的对象清理、失败回滚策略等）。
